
# 跨链桥的类型

- 多签

多签钱包时最传统的跨链桥方案。用户将资金发送到多签钱包，链下节点通过状态查询得知用户发送的代币。
传统实现的优势是安全、稳定、快速。同时通过签名机，可以保证签名机只和单一服务单点通讯，签名机只进行push和pull，保证签名机网络隔离，减少合谋的风险。
缺点是交易手续费高，同时用户难以对项目方做到完全的信任。

- Taproot+Schnorr多签

通过Taproot升级，原生Schnorr多签被引入到比特币中，如此一来就能够达到隐私、节约手续费效果。
尽管mulsig2实现的多签只能做到n-n。但是通过Tapsciprt，可以采用深度默克尔树构建多个分支，来实现m-n的门限签名。
于此同时，由于签名的逻辑完全在比特币网络上验证，因此也可以采用去中心化的方式构建链下网络。
缺点在于目前没有找到足够权威的在Bitcoin上的具体实现。

- DLC+多签

这是一种最近出现的跨链桥，通过预言机来实现资产的锁定和释放。
DLC能够令神谕作为第三方参与到资产的管理中。在这个第三方足够可靠的前提下，将能够达到去信任化的效果。
相对于前两种方案，DLC的实现中，将为每个用户单独构建一个钱包地址，而不是所有用户都将资金发往同一个地址。
缺点同样在于目前缺乏实战案例和权威实现，而且在用户数量增加之后，维护成本也会增加。

# BTC跨链桥案例详解


# WBTC - 多签
BitGo 和 Kyber Network 联合发起WBTC(Wrapped BTC)，是当前铸造量最大的 BTC 锚定资产。


WBTC 对公证人的角色进行了拆分，分为了托管商（ Custodian ，目前只有BitGo）和兑换商( Merchant )。兑换商是介于用户和托管商之间的一个中介角色，将用户和托管商隔绝开来，用户与兑换商交互，兑换商和托管商交互。理论上，兑换商和托管商都不止有一个。无论是兑换商，和还是托管商，都必须是 WBTC DAO 的成员，而 WBTC DAO 成员的新增和清退则由现有成员通过 M-of-N 多签合约来进行许可式管理。

### 关键角色

![image.png](https://cdn.nlark.com/yuque/0/2024/png/34890996/1708780984665-c6696468-f83c-4827-a1ad-e3c5da93228f.png#averageHue=%23f6f5f3&clientId=u83e3f135-2ae7-4&from=paste&height=432&id=ua9471dec&originHeight=648&originWidth=1148&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=295432&status=done&style=none&taskId=u045119e3-1a80-4586-a32b-8cb61eb5d48&title=&width=765.3333333333334)

### WBTC铸造
铸币操作，只能由兑换商发起。

### WBTC销毁
销毁WBTC，只能由兑换商才能发起。

### 用户交换
用户无权申请铸造和赎回，只能向兑换商买入或卖出 WBTC。用户可以用 BTC 和兑换商通过基于哈希时间锁的原子交易换取 WBTC，也可以用同样的方式将 WBTC 换回 BTC。

### 优缺点

- 优点：将铸币和销毁（用户不友好操作，过程缓慢）限制于托管商和兑换商之间，提升了用户跨链体验。

- 缺点：资金由单一托管商管理，虽然限制了多签账户只能向白名单（兑换商）转账，但仍然中心化严重，有拒付和跑路风险。

# ckBTC - 多签
ckBTC实际上更加接近一个侧链方案，其运作机制与wBTC并无特别大的差别，但是其优点在于能够支持使用ckBTC进行Dapp的开发，间接的令比特币能够运行智能合约，从而更像是一个带有功能性的Bitcoin Layer2,。总体而言，它的表现介于BEVM和wBTC之间。


### 运作流程
	参考BEVM，ckbtc的运作机制基本上是差不多的，如下图所示：
![image.png](https://cdn.nlark.com/yuque/0/2024/png/34890996/1708780949652-ce06a5ed-4c15-4c1e-8eeb-172c05210cb7.png#averageHue=%23fafafa&clientId=u83e3f135-2ae7-4&from=paste&height=235&id=u02e15423&originHeight=352&originWidth=1129&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=59844&status=done&style=none&taskId=uec17d460-8413-42a1-a8be-00e09ea125f&title=&width=752.6666666666666)
	具体来说，虽然ckBTC声称自己并不是一种warpped的BTC，但实际上，它也要求用户首先将btc传输到对应的特殊账户中。在icp节点会持续的监听这个账户，如果其中的UTXO与出块奖励无关，它们就会选择立刻铸造对应的ckBTC并交给对应的账户，否则会多等待几个确认，以保证该区块不会被撤销。
	如果用户希望回收它们的btc，它需要发送信息给icp网络，之后，用户的ckbtc会被销毁，同时该账户会通过一笔交易将金额返还给用户。
### 二层网络合约
	显然，为了能够同步比特币网络的状态，icp节点也需要同时运行一个比特币的轻节点。为了简洁性，icp节点将比特币网络的同步功能进行了整合，从而不用单独运行比特币的客户端。相较于BEVM，icp对同步的要求更高，它几乎会对比特币网络进行完全的同步，包括所有的UTXO信息，来保证能够实时验证比特币中任意地址的状态。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/34890996/1708780961177-ec33bd00-a144-4aa5-9642-e12ae71a16e6.png#averageHue=%23fcfcfc&clientId=u83e3f135-2ae7-4&from=paste&height=348&id=uaff2358f&originHeight=522&originWidth=1130&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=107079&status=done&style=none&taskId=ue00a825b-2797-4daf-8be7-8710ca242bd&title=&width=753.3333333333334)
	具体来说，icp通过一类叫做BTC canister的角色，通过ICP的协议堆栈集成并进行通信。其分别为ckBTC铸币机和ckBTC分账者。ckBTC铸币机在接收比特币时铸造新的ckBTC代币。同样，每当ckBTC代币的持有者请求提取比特币时，它都会销毁ckBTC代币。ckBTC铸币机在铸造ckBTC之前会等待大量的确认，而在将BTC转回用户之前会销毁ckBTC。


对于将BTC转移到用户的操作，采用了最佳努力的方法，即用户无法获得被销毁的ckBTC。相反，ckBTC铸币机会反复尝试将BTC转出，直到转账成功。需要注意的是，“用户”是指下文中由ckBTC铸币机和ckBTC分类帐公开的功能的调用者。这个调用者可以是人类用户，也可以是另一个canister。


ckBTC分账机则比较简单，其实就是负责维护ckbtc的在icp网络的本地账本，在ckBTC代币被转移时它会更新余额账户，并执行来自ckBTC铸币机的铸币和销毁操作。


### 去中心化
在icp中，并没有采用比特币最近比较关注的聚合签名方案；为了实现多签（门限签名），icp采用了一种叫做链式ECDSA密钥的密码学工具。不过无论如何，这个工具实际上的效果就是将普通的ECDSA的秘钥转化为能够逐个进行验证的门限签名，实际上效果与schnorr签名并无太大差别。但是其优点在于目前比特币主流上更加支持ECDSA，因此可以在不用依赖tapscript的基础上也能做到比较灵活的多签。
当前实施的ECDSA链密钥签名协议使用单个主私钥，可以使用类似BIP-32的密钥派生来为canisters生成密钥。每个canister都有一个这样的根密钥，使用canister id可以派生出一个，还可以使用BIP-32的向后兼容扩展来派生任意数量的其他canister密钥。最初，在icp上的一个签名子网上部署了ECDSA链密钥签名，该子网将回应canisters的签名请求。签名子网强制规定，只有控制密钥的canister才能请求使用此密钥进行签名。所有由canisters发出的API调用都需要通过XNet流量经过以获得签名相关的额外延迟。Canisters可以查询它们自己或其他canisters的公钥，包括canisters的更多派生公钥。Canisters可以使用它们控制的私钥，即它们的根私钥和派生私钥，请求签名。


### 优缺点
- 优点：icp是一个特别侧重实用性的方案，通过对比特币网络较为持续性，完整的同步，来保证网络的安全性。通过门限ECDSA签名，来确保网络有一定的去中心化程度。最后，icp也有比较完整的生态和资产，能够将ckbtc用于多链的互通。
- 缺点：icp的节点开销太大。同步比特币网络意味着高额的存储，内存，网络压力。显然节点的准入要求比较高，因此其去中心化程度比较难以保证。

## BEVM - Taproot + Schnorr多签
BEVM是一款基于ChainX进行二次开发的Bitcoin二层网络，其融合了其他平台的技术，并尽可能的利用了Bitcoin Core 0.21之后的一些特性，例如taproot，深度默克尔树，聚合签名方案等。这些站在巨人肩膀上的行为，以及它宣称对Ordi铭文的支持，使得其在最近的Bitcoin layer2方案中占据了极高的话题度，并且网络中也已经存在近千万级别的资产。

### 总体框架
以BEVM为首的，试图将功能可扩展性引入Bitcoin Layer2的各类尝试，其最核心的思想在于两点，分别为：使用类似Rollup的思想，能够令比特币网络核对二层网络账户状态的实现，以及将某个比特币地址，通过一些方法转换为一个类似于以太坊当中的合约地址。总体来说，其运作方式可以用下图进行表示：


![image.png](https://cdn.nlark.com/yuque/0/2024/png/34890996/1708780908553-9c83cf34-22e7-472b-b28c-87a19f08afe6.png#averageHue=%23fcfcfc&clientId=u83e3f135-2ae7-4&from=paste&height=255&id=u89b4b0e7&originHeight=383&originWidth=841&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=31906&status=done&style=none&taskId=u60f0c38d-8820-4cbc-9ded-9082485b65d&title=&width=560.6666666666666)


	图中，蓝线表示资产从比特币网络跨链到BEVM网络，红线表示从资产从BEVM重新回到比特币网络。事实上，Taproot账户就和以太坊中的合约地址的概念类似，比特币中的用户A通过将比特币发送到BEVM指定的，包含了Tapscript的，一个使用了聚合公钥的账户之中，事实上就已经完成了跨链（我们甚至可以认为，跨链桥就是这个taproot地址）。


### 资产进入和使用

在图中，A将10个btc发送到了跨链桥当中；随后，跨链桥的节点（矿工）接受到了这笔交易。注意，在BEVM当中，每个矿工都需要同时运行一个比特币网络的轻节点，以便于快速的识别比特币中打过来的交易。在确定A将10块钱打入taproot地址之后，矿工们将根据协议，在另外一个和用户A商议好（或者在生成之后发送给他）的地址B中，加入10个BEVM btc，在这里我们简称xbtc。需要注意，这个过程和多签，聚合签名之类的技术都没有关系。

显然，用户A对于位于BEVM当中的地址B拥有完全的所有权，在成功时候到了10个xbtc之后，它就可以用xbtc在BEVM中，和BEVM的合约地址进行交互了。在图中，Contract VM指搭载了合约代码的，BEVM合约地址。地址B可以通过xbtc与之进行交互，并且和其他的BEVM地址通过合约进行资产交换。在访问合约的时候，由于资产发生了变化，而这些变化显然应该反应在Taproot的账户当中，因此这里产生了两种做法：


（1）所有的状态变化，都应该能够在Taproot的地址中展现出来（例如，对不同的用户设置不同的找零地址）
（2）变化只需要在进行提款的时候进行体现即可


目前BEVM采用的是第二种方法，因此，这带来了一个衍生的问题（或者缺点），就是BEVM不支持除了ORDI之外的铭文。这是由于在提款时，BEVM事实上不会对某一笔UXTO做特殊的找零，而是会全部当做同质化代币处理。归根究底，这正是因为没有对每一个存入跨链桥的账户做特殊的找零处理（状态变化）所导致的问题。但之所以没有这样做，主要还是出于效率和费用的考虑。
### 资产退出
任意一笔资产，例如用户A，如果希望退出BEVM，显然从实质上看，就是Taproot地址会将一笔资金发往A，完成整个生命周期。在图中，A在BEVM的合约中消耗了1个xbtc，因此显然它只能从taproot地址中提取出9个btc。


在进行退出的时候，事实上需要地址B先往BEVM当中某个特殊的合约地址发送xbtc，才能够开始整个退出流程。为了简便，图中也使用了contract VM表示这个特殊合约。在合约收到这个退出信号之后（事实上就是BEVM的矿工收到了这个信号），它们就会开始通过POS+PBFT的共识进行通信，并试图生成门限签名所需要的秘钥。在这里，我们暂时将整个过程理解为：Taproot账号使用了一个多签公钥，并通过tapscript指定了一个n-m的门限签名；这里n指需要多少个签名，m指一共存在多少个签名。在BEVM当中， 3n = 2m。只要有三分之二的矿工同意，最终矿工们就能够生成秘钥，并且构造一笔合法的，从taproot账户发送9个btc到A账户的交易。


最终，账户B中的9个xbtc被销毁，taproot账户通过网络中2/3个矿工所构造的多签交易（并满足了tapscript），构造了一笔发往A账户的交易，注意，这笔交易位于比特币网络。在这笔交易得到了足够多的确认之后，A将收到9个btc，整个跨链生命周期结束。

	构造taproot账户以及tapscript

	从以上的流程中可以看到，Bevm从工程实践的角度看，最关键的部分显然就是如何构造这个taproot账户，以及这个账户对应的tapscript应该如何构造。在Bitcoin Core 0.24中，创建方式非常的简单，通过在Output Descriptors创建以下指令即可：tr(KI,multi_a(21,K1,K2,K3,K4,...,K210))，其中，每个K都对应一个multisig的私钥碎片。与此同时，创建多签钱包也并不困难，通过createmultisig以及addmultisigaddress命令，也能够在QT客户端返回对应的Output Descriptors来创建。
	
比较困难的问题在于创建聚合签名（如schnorr签名），以及构造适合聚合签名的tapscript，不过幸运的是目前已经有了一些解决方案，例如bip-0340提案。但是请注意，目前聚合签名方案还没有被bitcoin core所收录，因此，具体的聚合过程需要项目方自己进行完成。但是Tapscript支持对schnorr签名进行验证，通过OP_CHECKSIGADD指令，能够累进式的判断最终签名是否成功。


### 优缺点
- 优点：BEVM是一个比较完整的比特币二层网络的实现。相较于侧链实现，其资产事实上还处于BTC网络中，因此其最终的状态100%由比特币网络确定；相较于其他的二层方案，它能够支持去中心化的执行方式，因此安全性更加具有保障。
- 缺点：其中比较主要的就是对脚本的支持还有所欠缺；同时，它并不能做到和rollup一样，完全的将状态展现在taproot地址当中。

## Bison - DLC+多签

DLC是一种特殊的比特币script类型，能够让参与双方按照神域给定的信息来分配资金。对于跨链桥来说，用户将资金存储在一个与项目方共同的2-2多签钱包中，并且构造多比交易，按照神域发出的信息，来决定最终资金的去向。目前已知使用（或者即将使用）DLC构建跨链桥的项目有Bison network和DLC.link

### 运作流程
对于Bison网络中的每一个L1资产，都会设置一个对应的DLC，其逻辑如下：

- 资产控制权转移至Bison网络：如果预言机接收到L2消息请求使用特定资金，控制权将转移给Bison网络以进行进一步的资产分配。
- 用户提现：如果预言机接收到L2消息，表明用户有提现意图，控制权将返还给用户。
- 自动返回：如果长时间未收到消息（例如，一年），资产将自动返回给用户。

当前看来，DLC主要的应用还是在于模拟一种更加灵活的哈希时间锁功能。

### Bison的优缺点
通过DLC机制最大的优点在于，项目方不再成为资产的实际控制者。即便项目方作恶，资产也只能处于被锁定状态。与此同时，DLC也能够结合哈希时间锁，令用户得到退款。
但是其缺点也非常明显，可靠的神谕仅仅存在于理论层面，实际上如何保证神谕可靠是一个难以实现的问题。